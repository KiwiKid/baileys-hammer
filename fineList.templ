package main

import (

"fmt"
"github.com/dustin/go-humanize"
)

templ fineList(fines []FineWithPlayer, page int, isFineMaster bool) {
	<div
 		class="container mx-auto text-center"
 		id="fine-list-container"
	>
		<div class="text-3xl p-10">
			Recent Fine List
			<button hx-get="/fines" hx-target="#fine-list-container" hx-swap="outerHTML" hx-trigger="click" class="text-3xl">↻</button>
		</div>
		<table id="fine-list" class="min-w-full divide-y divide-gray-200">
			<thead class="bg-gray-50">
				<tr>
					<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
						Player
					</th>
					<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
						Reason
					</th>
					<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
						Amount
					</th>
					<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
						Approved
					</th>
					<th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
						Contest
					</th>
				</tr>
			</thead>
			<tbody class="bg-white divide-y divide-gray-200">
				for _, f := range fines {
					@fineRow(isFineMaster, f)
				}
			</tbody>
		</table>
		<!--<div class="py-3">
			<button hx-get={ fmt.Sprintf("/load-more?page=%d", page +1) } hx-target="this" hx-swap="outerHTML" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded hover:bg-blue-700">
				Load More
			</button>
		</div>-->
	</div>
}

templ fineRow(isFineMaster bool, f FineWithPlayer) {
	<tr
 		id={ fmt.Sprintf("fr-%d", f.Fine.ID) }
 		if f.Fine.Approved {
			class="bg-white divide-y divide-gray-200"
		} else {
			class="bg-yellow-200 divide-y divide-gray-200"
		}
	>
		<td>{ f.Player.Name }</td>
		<td class="text-sm text-gray-900 flex flex-col text-wrap">
			<div>
				{ f.Fine.Reason }
			</div>
			<div class="text-sm text-gray-900 w-4 md:w-12 ">{ f.Fine.Context }</div>
			<div>{ humanize.Time(f.Fine.FineAt) }</div>
		</td>
		<td class="whitespace-nowrap text-sm text-gray-900">
			if f.Fine.Approved {
				{ fmt.Sprintf("%v", f.Fine.Amount) }
			} else {
				----
			}
		</td>
		<td>
			if f.Fine.Approved {
				<div>✅</div>
			} else if isFineMaster {
				<form hx-post="/fines/approve" method="POST">
					<input
 						type="hidden"
 						name="fid"
 						value={ fmt.Sprintf("%d", f.Fine.ID) }
					/>
					<input
 						type="number"
 						name="amount"
 						id="amount-input-3"
 						class="px-2 py-1 border rounded"
 						placeholder="Set amount"
					/>
					<button
 						type="submit"
 						class={ bigAdd }
					>
						Approve
					</button>
				</form>
			} else {
				(Pending approval)
			}
		</td>
		<td>
			if len(f.Fine.Contest) == 0 {
				<button
 					hx-get={ fmt.Sprintf("/fines/edit/%d?isContest=true", f.Fine.ID) }
 					hx-swap="outerHTML"
 					class={ bigSec }
				>Contest</button>
			} else {
				{ f.Fine.Contest }
			}
		</td>
		if isFineMaster {
			<td>
				<button
 					hx-get={ fmt.Sprintf("/fines/edit/%d?isEdit=true", f.Fine.ID) }
 					hx-target={ fmt.Sprintf("#fr-%d", f.Fine.ID) }
 					hx-swap="outerHTML"
 					hx-target-error="#any-errors"
 					class={ bigSec }
				>edit</button>
			</td>
		}
	</tr>
}

templ fineContestRow(f FineWithPlayer) {
	<div class="px-2 py-2 gap-2 border rounded">
		<p class="text-3xl p-10">Contest this fine:</p>
		<div class="py-2">
			<input
 				type="text"
 				name="contest"
 				value={ f.Fine.Contest }
 				class="px-2 py-1 border rounded w-full"
 				placeholder="Reason"
			/>
		</div>
		<div class="py-2">
			<input
 				type="hidden"
 				name="fid"
 				value={ fmt.Sprintf("%d", f.Fine.ID) }
			/>
		</div>
		<div class="py-2">
			<button
 				class={ bigAdd }
 				hx-post={ fmt.Sprintf("/fines/contest", ) }
 				hx-target={ fmt.Sprintf("#fr-%d", f.Fine.ID) }
 				hx-swap="outerHTML"
 				hx-include="closest tr"
 				type="submit"
			>
				Save
			</button>
		</div>
		<div class="w-full">
			<a
 				href={ templ.SafeURL("/#fine-list") }
 				class={ bigSec }
			>
				Cancel
			</a>
		</div>
	</div>
}

templ fineEditRow(f FineWithPlayer) {
	<tr
 		id={ fmt.Sprintf("fr-%d", f.Fine.ID) }
 		class="bg-white divide-y divide-gray-200"
	>
		<td class="px-6 py-4">
			<label for="reason">Reason</label>
			<input
 				type="text"
 				name="reason"
 				value={ f.Fine.Reason }
 				class="px-2 py-1 border rounded w-full"
 				placeholder="Reason"
			/>
			<input
 				type="text"
 				name="context"
 				value={ f.Fine.Context }
 				class="px-2 py-1 border rounded w-full"
 				placeholder="Context"
			/>
			<input
 				type="playerId"
 				name="playerId"
 				value={ fmt.Sprintf("%v", f.Player.ID) }
 				class="invisible"
			/>
			<input
 				type="fid"
 				name="fid"
 				value={ fmt.Sprintf("%v", f.Fine.ID) }
 				class="invisible"
			/>
		</td>
		<td class="px-6 py-4">
			<input
 				type="number"
 				name="amount"
 				value={ fmt.Sprintf("%v", f.Fine.Amount) }
 				class="px-2 py-1 border rounded w-full"
 				placeholder="Amount"
			/>
		</td>
		<td>{ f.Player.Name }</td>
		<td>
			<select name="approved" class="px-2 py-1 border rounded">
				<option
 					value="true"
 					if f.Fine.Approved {
						selected
					}
				>Approved</option>
				<option
 					value="false"
 					if !f.Fine.Approved {
						selected
					}
				>Not Approved</option>
			</select>
		</td>
		<td>
			<input
 				type="date"
 				id="fineAt"
 				name="fineAt"
 				value={ f.Fine.FineAt.Format("2006-01-02") }
 				class="px-2 py-1 border rounded w-full"
			/>
		</td>
		<td>
			<button
 				class={ bigDel }
 				hx-confirm="Are you sure you want to delete the fine by this player?"
 				hx-delete={ fmt.Sprintf("/fines?fid=%d", f.Fine.ID) }
			>Delete</button>
			<button
 				class={ bigPri }
 				hx-post={ fmt.Sprintf("/fines/edit/%d", f.Fine.ID) }
 				hx-target={ fmt.Sprintf("#fr-%d", f.Fine.ID) }
 				hx-swap="outerHTML"
 				hx-include="closest tr"
 				type="submit"
			>
				Save
			</button>
			<button
 				hx-get={ fmt.Sprintf("/fines/edit/%d", f.Fine.ID) }
 				hx-target={ fmt.Sprintf("#fr-%d", f.Fine.ID) }
 				hx-swap="outerHTML"
 				type="button"
 				class={ bigSec }
			>
				Cancel
			</button>
		</td>
	</tr>
}

